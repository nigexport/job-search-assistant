<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fansu Job Assistant | The Exam Vault</title>
    <!-- Mandatory for 2026 Browser Mic Access -->
    <meta http-equiv="Permissions-Policy" content="microphone=(self)">
    <style>
        body { font-family: 'Inter', sans-serif; background: #f9f9f9; display: flex; justify-content: center; padding: 40px; }
        .card { background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); width: 100%; max-width: 500px; text-align: center; }
        #start-btn { background: #111; color: white; border: none; padding: 15px 30px; border-radius: 50px; font-size: 18px; cursor: pointer; transition: 0.3s; }
        #start-btn:disabled { background: #666; cursor: not-allowed; }
        #status { margin-top: 20px; color: #666; font-style: italic; display: none; }
        .job-card { text-align: left; border: 1px solid #eee; padding: 15px; border-radius: 12px; margin-top: 15px; transition: 0.2s; }
        .job-card:hover { border-color: #007bff; }
        .job-card h3 { margin: 0; font-size: 18px; }
        .job-card p { margin: 5px 0; color: #444; font-size: 14px; }
        .job-card a { color: #007bff; text-decoration: none; font-weight: bold; font-size: 14px; }
    </style>
</head>
<body>

<div class="card">
    <h2>üé§ Talk to Fansu</h2>
    <p>Get your forklift job recommendations in Germany.</p>
    <button id="start-btn">Start Career Chat</button>
    
    <div id="status">üîç Fansu is searching for roles...</div>
    <div id="job-container"></div>
</div>

<!-- Load ElevenLabs SDK directly -->
<script src="elevenlabs.io"></script>

<script>
    const btn = document.getElementById('start-btn');
    const status = document.getElementById('status');
    const container = document.getElementById('job-container');

    btn.onclick = async () => {
        try {
            // 1. Explicitly request Mic access
            await navigator.mediaDevices.getUserMedia({ audio: true });
            
            btn.disabled = true;
            btn.innerText = "Fansu is listening...";

            // 2. Start Session
            // Note: In 2026, the global is ElevenLabs (not ElevenLabsClient)
            const conversation = await ElevenLabs.Conversation.startSession({
                agentId: "agent_8901ke5m8kyfe0k9g7mfzvnh8te1",
                dynamicVariables: { "user_session_id": crypto.randomUUID() },
                clientTools: {
                    // This is the bridge that catches the jobs
                    display_jobs: (parameters) => {
                        status.style.display = 'none';
                        const jobs = parameters.jobs || [];
                        container.innerHTML = jobs.map(j => `
                            <div class="job-card">
                                <h3>${j.title}</h3>
                                <p><strong>${j.company}</strong> ‚Äî ${j.location}</p>
                                <p>${j.summary}</p>
                                <a href="${j.link}" target="_blank">Apply Now ‚Üí</a>
                            </div>
                        `).join('');
                        return "Jobs rendered successfully.";
                    }
                }
            });
        } catch (err) {
            console.error(err);
            alert("Connection failed. Ensure your Vercel URL is in the ElevenLabs Allowlist.");
            btn.disabled = false;
            btn.innerText = "Start Career Chat";
        }
    };
</script>

</body>
</html>
